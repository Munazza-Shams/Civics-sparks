<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <title>Civics Sparks ‚Äî Clean & Green Campus</title>

  <!-- PDF generation libraries (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <style>
      /* Page basics */
  body{font-family:Arial, sans-serif;margin:0;background:#f5f9f5;color:#222}
  header{background:#2e7d32;color:#fff;text-align:center;padding:30px}
  nav{display:flex;justify-content:center;background:#4caf50;padding:10px;gap:18px}
  nav a{color:white;text-decoration:none;font-weight:700}
  .card{background:#fff;margin:28px auto;max-width:980px;border-radius:14px;padding:18px;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
  footer{text-align:center;padding:18px;background:#2e7d32;color:#fff;margin-top:30px}

  .game-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:18px}

  .game-card{background:#fff;border-radius:14px;padding:18px;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .game-card h3{margin:8px 0}
  .play-btn{background:#2e7d32;color:#fff;border:0;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700}

  /* overlays */
  .overlay{display:none;position:fixed;inset:0;justify-content:center;align-items:center;background:rgba(0,0,0,0.6);z-index:12000}
  .center-card{background:#fff;border-radius:16px;padding:22px;width:760px;max-width:95%;box-shadow:0 12px 40px rgba(0,0,0,0.25);text-align:center}
  .btn{padding:8px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
  .btn-green{background:#2e7d32;color:#fff}
  .btn-gray{background:#ddd;color:#222}
  .muted{color:#666;font-size:0.95rem}

  /* quiz */
  .optionBtn{display:block;margin:8px auto;padding:10px 16px;border-radius:8px;width:75%;border:1px solid #ccc;cursor:pointer}
  .optionBtn.selected{background:#c8e6c9;border-color:#2e7d32}

  /* drag bins */
  .bin{width:120px;height:100px;border-radius:10px;display:flex;align-items:center;justify-content:center;padding:8px}

  /* runner area */
  #runnerArea{position:relative;width:360px;height:220px;background:#e1bee7;border-radius:12px;overflow:hidden;margin:14px auto}

  /* certificate exact theme (as you provided) */
  .cert-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:13000}
  .cert-box{
    position: relative;
    width: 700px;
    height: 520px;
    background: linear-gradient(135deg, #d1c47b 0%, #119711 100%);
    border-radius: 25px;
    box-shadow: 0 12px 32px rgba(0,0,0,0.25);
    padding: 40px 60px 50px 60px;
    box-sizing: border-box;
    font-family: 'Georgia', serif;
    color: #3a2f0d;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    overflow: hidden;
  }
  .cert-left{flex:1;max-width:320px}
  .cert-left .uni{font-size:0.9rem;font-weight:600;color:#204214;text-transform:uppercase;margin-bottom:12px}
  .cert-title{font-size:1.8rem;font-weight:900;color:#2e5f0e;margin-bottom:14px}
  .cert-name{font-family:'Dancing Script',cursive;font-size:3rem;font-weight:700;color:#b8860b;margin-bottom:12px}
  .cert-main{font-size:1.1rem;font-weight:600;color:#3b4f13;line-height:1.4}
  .cert-extra{font-size:0.9rem;margin-top:8px;color:#49651e;font-style:italic}
  .cert-issued{font-size:0.85rem;color:#415215;margin-top:24px}

  .cert-star{
    position:absolute;top:110px;left:480px;width:90px;height:90px;background:radial-gradient(circle at center,#f9d976 0%,#f39c12 70%);border-radius:50%;box-shadow:0 0 15px #f39c12;display:flex;justify-content:center;align-items:center;font-size:40px;font-weight:700;color:#8a6d0a;transform:rotate(-10deg);
  }

  .cert-right{margin-top:50px}
  .cert-right .org{font-family:'Brush Script MT',cursive;font-size:2.4rem;color:#9f7d0a;font-weight:700}
  .cert-actions{position:fixed;bottom:40px;right:50%;transform:translateX(50%);display:flex;gap:20px;z-index:14000}

  /* small helpers */
  .row{display:flex;gap:12px;align-items:center;justify-content:center}
  input[type="text"], input[type="email"]{padding:8px;border-radius:8px;border:1px solid #ccc;width:260px}
  textarea{padding:8px;border-radius:8px;border:1px solid #ccc;width:100%}
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f9f5;
      color: #222;
    }

    header {
      background: #2e7d32;
      color: white;
      text-align: center;
      padding: 30px 15px;
    }

    nav {
      display: flex;
      justify-content: center;
      background: #4caf50;
      gap: 20px;
      padding: 10px;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .card {
      background: white;
      margin: 30px auto;
      max-width: 900px;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    footer {
      text-align: center;
      padding: 20px;
      background: #2e7d32;
      color: white;
      margin-top: 40px;
    }

    .social-links a {
      color: white;
      margin: 0 10px;
      font-size: 20px;
    }

    .member img {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
    }

    .members {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    #certForm input {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 250px;
    }

    #certForm button {
      background: #2e7d32;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <header id="home">
    <h1>üåø Civics Sparks ‚Äì Clean & Green Campus</h1>
    <p>We are <strong>DCSE | Civics Sparks</strong> ‚Äî UET Peshawar. Working together for a cleaner campus.</p>
  </header>

  <nav>
  <!-- <div class="logo">üåø Civics Sparks</div> -->
  <button class="nav-toggle" aria-label="Toggle navigation">
    <i class="fas fa-bars"></i>
  </button>
  <div class="nav-links">
    <a href="#home">Home</a>
    <a href="#about">About</a>
    <a href="#aim">Our Aim</a>
    <a href="#team">Team</a>
    <a href="#members">Members</a>
    <a href="#games">Games</a>
    <a href="#poll">Poll</a> 
    <a href="#contact">Contact</a>
  </div>
</nav>

  <main>
    <section id="about" class="card">
      <h2>About Us</h2>
     <div class="para" width="400px">
       <p> Civics Sparks is a student-led initiative founded by the Department of Computer Systems Engineering at UET Peshawar. Our mission is to inspire environmental responsibility, civic awareness, and community participation among university students. We work to make our campus a cleaner, greener, and more sustainable place through awareness campaigns, interactive games, and hands-on cleanliness drives. By combining technology, creativity, and teamwork, Civics Sparks empowers students to turn small daily actions into lasting positive change for our environment.</p>
    <img src="./logo.jpg" width="200px" alt="">
    </div>
    </section>

<!-- üåø OUR AIM SECTION -->
<section id="aim" class="card" style="background:linear-gradient(135deg,#e8f5e9,#f1f8e9);border-radius:20px;box-shadow:0 6px 18px rgba(0,0,0,0.1);padding:40px;transition:transform 0.3s;">
  <h2 align="center" style="color:#2e7d32;margin-bottom:20px;font-size:1.8rem;">üåé Our Aim</h2>
  <p style="font-size:1.1rem;line-height:1.6;color:#333;text-align:justify;">
    At <strong>Civics Sparks</strong>, our aim is to build a campus culture rooted in environmental care, civic sense, and collective responsibility.  
    We strive to engage students in activities that promote sustainability, waste reduction, and digital awareness through innovation and teamwork.  
    Our vision is to create a <strong>Clean and Green UET</strong> ‚Äî a campus where every individual takes pride in protecting nature and inspiring others to do the same.
  </p>

  <div style="display:flex;justify-content:center;gap:20px;margin-top:25px;flex-wrap:wrap;">
    <div style="background:#a5d6a7;padding:20px;border-radius:16px;width:260px;text-align:center;">
      <h3 style="color:#1b5e20;">üå± Sustainability</h3>
      <p style="color:#2e7d32;">Encouraging eco-friendly habits and green technologies.</p>
    </div>
    <div style="background:#c8e6c9;padding:20px;border-radius:16px;width:260px;text-align:center;">
      <h3 style="color:#2e7d32;">ü§ù Responsibility</h3>
      <p style="color:#33691e;">Motivating students to take civic and environmental responsibility.</p>
    </div>
    <div style="background:#dcedc8;padding:20px;border-radius:16px;width:260px;text-align:center;">
      <h3 style="color:#388e3c;">üí° Innovation</h3>
      <p style="color:#33691e;">Using creativity and technology to spread awareness and change.</p>
    </div>
  </div>
</section>

    <section id="team" class="card">
      <h2>Our Team</h2>
      <img src="./grp-pic.jpg"  width="700px">
      <p><strong>Civics Sparks</strong> ‚Äî DCSE, UET Peshawar.</p>
    </section>

    <section id="members" class="card">
      <h2>Meet Our Members</h2>
      <div class="members">
        <div class="member"><img src="./mona.jpg" alt=""><h4>Munazza</h4></div>
        <div class="member"><img src="./gul.jpg" alt=""><h4>Gul Seema</h4></div>
        <div class="member"><img src="./arish.jpg" alt=""><h4>Arish Fatima</h4></div>
        <div class="member"><img src="./arham.jpg" alt=""><h4>Arham Shahzad</h4></div>
         <div class="member"><img src="./huzaifa1.jpg" alt=""><h4>Huzaifa Khan</h4></div>
        <div class="member"><img src="./saad.jpg" alt=""><h4>Saad Subhan</h4></div>
        <div class="member"><img src="./huzaifaS.jpg" alt=""><h4>Huzaifa Sabir</h4></div>
        <div class="member"><img src="./abubakkar.jpg" alt=""><h4>Abubakkar</h4></div>
        <div class="member"><img src="./inaam.jpg" alt=""><h4>Inamullah</h4></div>

      </div>
    </section>
 <section id="games" class="card">
    <h2>üéØ Clean & Civic Games</h2>
    <p class="muted">Play, learn and earn your certificate.</p>

    <div class="game-grid" style="margin-top:14px">
      <!-- Quiz -->
      <div class="game-card">
        <h3>üßπ Clean Campus Quiz</h3>
        <p class="muted">10 multiple choice questions about cleanliness & civic sense.</p>
        <button class="play-btn" data-game="quiz">Play Now</button>
      </div>

      <!-- Recycle -->
      <div class="game-card">
        <h3>‚ôªÔ∏è Waste Sort Challenge</h3>
        <p class="muted">Drag & drop items into correct bins.</p>
        <button class="play-btn" data-game="recycle">Play Now</button>
      </div>
      <!-- Runner -->
      <div class="game-card">
        <h3>üöÆ Clean-up Runner</h3>
        <p class="muted">Click trash items fast to score.</p>
        <button class="play-btn" data-game="runner">Play Now</button>
      </div>
    </div>
  </section>
  <iframe src="poll.html" id="poll" style="width:100%; height:400px; border:none; overflow:visible;"></iframe>

     <section id="contact" class="card">
      <h2 align="center">Contact & Join</h2>
      <p align="center">Want to join or suggest? Message us.</p>
      <form id="joinForm" action="mailto:dcsecivicsparks@gmail.com" 
    method="post" 
    enctype="text/plain"  style="display:flex;flex-direction:column;max-width:500px;margin:auto;gap:10px;">
        <input placeholder="Your name" required>
        <input placeholder="Your email" required>
        <textarea placeholder="Your message" required></textarea>
       <div style="display:flex; justify-content:center; margin-top:20px;">
  <button id="submitting" type="submit">Send</button>
</div>
      </form>
    </section>
  </main>

  <footer>
    <div class="social-links">
      <a href="https://www.instagram.com/uet_dcse_csparks" target="_blank"><i class="fab fa-instagram"></i></a>
      <a href="http://tiktok.com/@civicspark" target="_blank"><i class="fab fa-tiktok"></i></a>
    </div>
    ¬© DCSE | Civics Sparks | UET Peshawar.
  </footer>


<!-- PLAYER DETAILS FORM (overlay) -->
<div id="playerFormOverlay" class="overlay" style="display:none">
  <div class="center-card">
    <h3>Enter your details</h3>
    <div style="margin:12px 0">
      <input id="playerName" type="text" placeholder="Your name" />
    </div>
    <div style="margin:12px 0">
      <input id="playerEmail" type="email" placeholder="Your email" />
    </div>
    <div style="margin:12px 0">
      <input id="playerDept" type="text" placeholder="Your department" />
    </div>
    <div style="margin-top:14px">
      <button id="startBtn" class="btn btn-green">Start Game</button>
      <button id="cancelForm" class="btn btn-gray">Cancel</button>
    </div>
  </div>
</div>

<!-- GAME POPUP (center card) -->
<div id="gameOverlay" class="overlay" style="display:none">
  <div id="gameCard" class="center-card">
    <!-- dynamic content here -->
  </div>
</div>

<!-- Certificate modal (your exact theme) -->
<div id="certModal" class="cert-modal">
  <div class="cert-box">
    <div class="cert-left">
      <div class="uni">University of Engineering & Technology, Peshawar<br><span style="font-size:0.75rem;color:#346f0e">DCSE | Civics Sparks</span></div>
      <div class="cert-title">Certificate of Appreciation</div>
      <div id="certPersonName" class="cert-name">Student Name</div>
      <div id="certMainLine" class="cert-main">has successfully completed the Quiz Game</div>
      <div id="certExtra" class="cert-extra">Details...</div>
      <div id="certIssuedOn" class="cert-issued">Awarded on: <span id="certDateStr"></span></div>
    </div>

    <div class="cert-star">‚òÖ</div>

    <div class="cert-right">
      <div class="org" style="font-family:'Brush Script MT',cursive">Civics Sparks</div>
      <div style="font-size:0.85rem;font-weight:600;color:#456014;margin-top:-8px">Department of Computer Systems Engineering</div>

      <div class="cert-actions">
        <button id="downloadCert" class="btn btn-green">Download PDF</button>
        <button id="closeCert" class="btn btn-gray">Close</button>
      </div>
    </div>
  </div>
</div>

  <script>
    
/* ======= Questions for quiz (10) ======= */
const QUIZ_QUESTIONS = [
  { q: "What should you do if you see litter on campus?", o: ["Ignore it", "Pick it up and put in bin", "Kick it aside"], a: 1 },
  { q: "Which bin is usually for recyclable plastics?", o: ["Blue bin", "Green bin", "Black bin"], a: 0 },
  { q: "Why are trees important on campus?", o: ["They block students", "They produce oxygen & shade", "They increase noise"], a: 1 },
  { q: "What saves electricity?", o: ["Leaving lights on", "Turning off unused lights", "Using more chargers"], a: 1 },
  { q: "Where does food waste belong?", o: ["Recycle bin", "Compost/organic bin", "Glass bin"], a: 1 },
  { q: "‚ÄòReduce‚Äô in ‚ÄòReduce, Reuse, Recycle‚Äô means:", o: ["Use fewer resources", "Recycle bottles only", "Buy more items"], a: 0 },
  { q: "Which is recyclable?", o: ["Used tissue", "Glass bottle", "Rotten banana"], a: 1 },
  { q: "Clean campus benefits:", o: ["Health & learning", "Only aesthetics", "Nothing"], a: 0 },
  { q: "Best way to travel short campus distance:", o: ["Walk or cycle", "Drive car", "Use heavy truck"], a: 0 },
  { q: "Who should you report overflowing bins to?", o: ["Campus management", "Ignore it", "Throw more waste"], a: 0 }
];

/* ======= State ======= */
let activeGame = null;
let player = { name: '', email: '', dept: '' };

/* ======= Elements ======= */
const playerFormOverlay = document.getElementById('playerFormOverlay');
const gameOverlay = document.getElementById('gameOverlay');
const gameCard = document.getElementById('gameCard');
const startBtn = document.getElementById('startBtn');
const cancelForm = document.getElementById('cancelForm');

const certModal = document.getElementById('certModal');
const certBox = document.querySelector('.cert-box');
const certPersonName = document.getElementById('certPersonName');
const certMainLine = document.getElementById('certMainLine');
const certExtra = document.getElementById('certExtra');
const certDateStr = document.getElementById('certDateStr');
const downloadCert = document.getElementById('downloadCert');
const closeCert = document.getElementById('closeCert');

/* ======= Play buttons open form ======= */
document.querySelectorAll('.play-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    activeGame = btn.dataset.game; // 'quiz'|'recycle'|'pledge'|'runner'
    // show form
    document.getElementById('playerName').value = '';
    document.getElementById('playerEmail').value = '';
    document.getElementById('playerDept').value = '';
    playerFormOverlay.style.display = 'flex';
  });
});

/* cancel form */
cancelForm.addEventListener('click', ()=> playerFormOverlay.style.display = 'none');

/* start game after entering details */
startBtn.addEventListener('click', ()=>{
  const name = document.getElementById('playerName').value.trim();
  const email = document.getElementById('playerEmail').value.trim();
  const dept = document.getElementById('playerDept').value.trim();
  if(!name || !email || !dept){ alert('Please fill all fields'); return; }
  player = { name, email, dept };
  playerFormOverlay.style.display = 'none';
  openGame(activeGame);
});

/* ======= Game handlers ======= */

function openGame(game){
  // reset and show overlay
  gameOverlay.style.display = 'flex';
  if(game === 'quiz') openQuiz();
  else if(game === 'recycle') openRecycle();
  else if(game === 'pledge') openPledge();
  else if(game === 'runner') openRunner();
  else gameCard.innerHTML = '<p>Game not found.</p>';
}

/* ---------- QUIZ ---------- */
let quizIndex = 0;
let quizAnswers = Array(QUIZ_QUESTIONS.length).fill(null);
let quizScore = 0;

function openQuiz(){
  quizIndex = 0;
  quizAnswers = Array(QUIZ_QUESTIONS.length).fill(null);
  quizScore = 0;
  renderQuizQuestion();
}

function renderQuizQuestion(){
  const q = QUIZ_QUESTIONS[quizIndex];
  const total = QUIZ_QUESTIONS.length;
  gameCard.innerHTML = `
    <h2>üßπ Clean Campus Quiz</h2>
    <p class="muted">Question ${quizIndex+1} of ${total}</p>
    <div style="margin:14px 0;font-weight:700">${escapeHtml(q.q)}</div>
    <div id="quizOpts"></div>
    <div style="margin-top:16px" class="row">
      <button class="btn btn-gray" id="quizBack">Back</button>
      ${quizIndex < total-1 ? '<button class="btn btn-green" id="quizNext" disabled>Next</button>' : '<button class="btn btn-green" id="quizFinish" disabled>Finish Game</button>'}
    </div>
    <p id="quizWarning" class="muted" style="margin-top:8px"></p>
  `;
  const optsDiv = document.getElementById('quizOpts');
  q.o.forEach((opt, i)=>{
    const b = document.createElement('button');
    b.className = 'optionBtn';
    b.innerText = opt;
    b.dataset.idx = i;
    if(quizAnswers[quizIndex] !== null && quizAnswers[quizIndex] == i) b.classList.add('selected');
    b.addEventListener('click', ()=>{
      // mark answer
      document.querySelectorAll('#quizOpts .optionBtn').forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected');
      quizAnswers[quizIndex] = i;
      // enable next/finish
      if(quizIndex < QUIZ_QUESTIONS.length - 1){
        document.getElementById('quizNext').disabled = false;
      } else {
        // only enable finish if all questions answered
        const allAnswered = quizAnswers.every(ans => ans !== null);
        document.getElementById('quizFinish').disabled = !allAnswered;
        const warn = document.getElementById('quizWarning');
        warn.textContent = allAnswered ? '' : 'You must answer all questions before finishing.';
      }
    });
    optsDiv.appendChild(b);
  });

  // event handlers
  document.getElementById('quizBack').onclick = ()=>{
    if(quizIndex === 0){ gameOverlay.style.display = 'none'; return; }
    quizIndex--;
    renderQuizQuestion();
  };

  if(quizIndex < QUIZ_QUESTIONS.length - 1){
    document.getElementById('quizNext').onclick = ()=>{
      if(quizAnswers[quizIndex] === null) { alert('Please select an answer'); return; }
      quizIndex++;
      renderQuizQuestion();
    };
  } else {
    document.getElementById('quizFinish').onclick = ()=>{
      // ensure all answered
      if(quizAnswers.some(x=>x===null)){ alert('Please answer all questions before finishing.'); return; }
      // compute score
      quizScore = quizAnswers.reduce((s, ans, idx) => s + (ans === QUIZ_QUESTIONS[idx].a ? 1 : 0), 0);
      gameOverlay.style.display = 'none';
      showCertificate(activeGame, `${player.name}`, `Score: ${quizScore} / ${QUIZ_QUESTIONS.length}`);
    };
  }
}

/* ---------- RECYCLE (drag & drop) ---------- */
function openRecycle() {
  gameCard.innerHTML = `
    <h2>‚ôªÔ∏è Waste Sort Challenge</h2>
    <p class="muted">Drag each item into the correct bin. Sort all to finish.</p>
    <div style="display:flex;gap:24px;justify-content:center;align-items:flex-start;margin-top:18px">
      <div id="items" style="display:flex;flex-direction:column;gap:10px">
        <div draggable="true" class="dr-item draggable" data-type="plastic" style="padding:8px;background:#fff;border-radius:8px;cursor:grab;border:1px solid #ccc">Plastic Bottle</div>
        <div draggable="true" class="dr-item draggable" data-type="paper" style="padding:8px;background:#fff;border-radius:8px;cursor:grab;border:1px solid #ccc">Newspaper</div>
        <div draggable="true" class="dr-item draggable" data-type="organic" style="padding:8px;background:#fff;border-radius:8px;cursor:grab;border:1px solid #ccc">Banana Peel</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:12px">
        <div id="bin-plastic" class="bin" data-accept="plastic" style="border:2px dashed #1565c0;padding:20px">Plastic Bin</div>
        <div id="bin-paper" class="bin" data-accept="paper" style="border:2px dashed #4caf50;padding:20px">Paper Bin</div>
        <div id="bin-organic" class="bin" data-accept="organic" style="border:2px dashed #8bc34a;padding:20px">Organic Bin</div>
      </div>
    </div>
    <p id="recycleMsg" class="muted" style="margin-top:14px">Sorted: 0 / 3</p>
    <div style="margin-top:10px" class="row">
      <button class="btn btn-gray" id="recycleBack">Back</button>
      <button class="btn btn-green" id="recycleFinish" disabled>Finish Game</button>
    </div>
  `;

  const draggables = document.querySelectorAll('.draggable');
  const bins = document.querySelectorAll('.bin');
  const msg = document.getElementById('recycleMsg');
  const finishBtn = document.getElementById('recycleFinish');

  let sortedCount = 0;
  let activeDrag = null;

  // üñ± Mouse drag
  draggables.forEach(drag => {
    drag.addEventListener('dragstart', e => {
      e.dataTransfer.setData('type', drag.dataset.type);
      activeDrag = drag;
    });
    drag.addEventListener('dragend', () => (activeDrag = null));
  });

  // üñê Touch drag (mobile)
  draggables.forEach(drag => {
    drag.addEventListener('touchstart', e => {
      activeDrag = drag;
    });
    drag.addEventListener('touchmove', e => {
      e.preventDefault();
      const touch = e.touches[0];
      const el = document.elementFromPoint(touch.clientX, touch.clientY);
      bins.forEach(bin => {
        bin.style.background = el === bin ? '#e0f7fa' : '';
      });
    });
    drag.addEventListener('touchend', e => {
      const touch = e.changedTouches[0];
      const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
      if (dropTarget && dropTarget.classList.contains('bin')) {
        handleDrop(activeDrag, dropTarget);
      }
      bins.forEach(bin => (bin.style.background = ''));
      activeDrag = null;
    });
  });

  // üß∫ Desktop drop
  bins.forEach(bin => {
    bin.addEventListener('dragover', e => e.preventDefault());
    bin.addEventListener('drop', e => {
      e.preventDefault();
      const type = e.dataTransfer.getData('type');
      const draggedItem = document.querySelector(`[data-type="${type}"]`);
      handleDrop(draggedItem, bin);
    });
  });

   function handleDrop(item, bin) {
    if (item.dataset.type === bin.dataset.accept) {
      bin.appendChild(item);
      item.style.cursor = 'default';
      item.draggable = false;
      sortedCount++;
      msg.textContent = `Sorted: ${sortedCount} / 3`;
      if (sortedCount === 3) finishBtn.disabled = false;
    } else {
      alert('Wrong bin! Try again.');
    }
  }

  // üéØ Finish button now works
  finishBtn.addEventListener('click', () => {
    if (sortedCount === 3) {
      openCertificate(); // üëà Call your certificate function here
    } else {
      alert('Please sort all items first!');
    }
  });

  document.getElementById('recycleBack').onclick = () => location.reload();
}

/* ---------- RUNNER ---------- */
function openRunner(){
  gameCard.innerHTML = `
    <h2>üöÆ Clean-up Runner</h2>
    <p class="muted">Click items as they appear. Reach <strong>6</strong> clicks within <strong>12</strong> seconds to win.</p>
    <div id="runnerAreaContainer" style="margin-top:12px">
      <div id="runnerArea"></div>
      <p id="runnerMsg" class="muted">Score: 0</p>
    </div>
    <div style="margin-top:12px" class="row">
      <button class="btn btn-gray" id="runnerBack">Back</button>
      <button class="btn btn-green" id="runnerFinish" disabled>Finish Game</button>
    </div>
  `;

  const runnerArea = gameCard.querySelector('#runnerArea');
  const runnerMsg = gameCard.querySelector('#runnerMsg');
  const target = 6;
  let score = 0;
  let spawnInterval = null;
  let timer = null;
  runnerMsg.textContent = `Score: ${score}`;

  function spawnTrash(){
    const t = document.createElement('div');
    t.textContent = 'üóëÔ∏è';
    t.style.position = 'absolute';
    t.style.left = Math.random() * (runnerArea.clientWidth - 30) + 'px';
    t.style.top = Math.random() * (runnerArea.clientHeight - 30) + 'px';
    t.style.fontSize = '26px';
    t.style.cursor = 'pointer';
    runnerArea.appendChild(t);
    t.onclick = ()=> {
      score++;
      runnerMsg.textContent = `Score: ${score}`;
      t.remove();
      if(score >= target){
        gameCard.querySelector('#runnerFinish').disabled = false;
        // stop spawning early
        clearInterval(spawnInterval);
        clearTimeout(timer);
        // remove remaining trash
        Array.from(runnerArea.children).forEach(c=>c.remove());
      }
    };
    // auto remove if not clicked
    setTimeout(()=> { if(t.parentElement) t.remove(); }, 1400);
  }

  spawnInterval = setInterval(spawnTrash, 600);
  timer = setTimeout(()=> {
    clearInterval(spawnInterval);
    if(score < target){
      runnerMsg.textContent = `Time's up ‚Äî Score: ${score} (need ${target})`;
      // disable finish
      gameCard.querySelector('#runnerFinish').disabled = true;
    }
  }, 12000);

  gameCard.querySelector('#runnerBack').onclick = ()=> {
    clearInterval(spawnInterval);
    clearTimeout(timer);
    gameOverlay.style.display = 'none';
  };

  gameCard.querySelector('#runnerFinish').onclick = ()=> {
    clearInterval(spawnInterval);
    clearTimeout(timer);
    gameOverlay.style.display = 'none';
    showCertificate(activeGame, player.name, `Runner score: ${score}`);
  };
}

/* ======= Certificate ======= */
function showCertificate(gameName, playerName, extraText){
  // playerName: string, extraText (score/notes) optional
  certPersonName.textContent = playerName || 'Student Name';
  certMainLine.textContent = `has successfully completed the ${formatGameName(gameName)}`;
  certExtra.textContent = extraText || '';
  certDateStr.textContent = new Date().toLocaleDateString();
  certModal.style.display = 'flex';
}

closeCert.addEventListener('click', ()=> certModal.style.display = 'none');

/* Download certificate as PDF (capture the .cert-box element) */
downloadCert.addEventListener('click', async ()=>{
  // ensure cert is visible
  certModal.style.display = 'flex';
  // small delay to ensure rendering
  await new Promise(r=>setTimeout(r, 80));
  const canvas = await html2canvas(document.querySelector('.cert-box'), { scale: 2 });
  const img = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: 'landscape' });
  // Fit to landscape A4-like width
  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();
  // add with some margin
  pdf.addImage(img, 'PNG', 8, 8, pdfWidth - 16, pdfHeight - 16);
  pdf.save(`${(player.name || 'certificate').replace(/\s+/g,'_')}_CivicsSparks_Certificate.pdf`);
});

/* helper */
function formatGameName(g){ 
  if(!g) return 'Game';
  const map = { quiz:'Clean Campus Quiz', recycle:'Waste Sort Challenge', pledge:'Green Pledge Game', runner:'Clean-up Runner' };
  return map[g] || g;
}
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

downloadCert.addEventListener('click', async ()=>{
  const buttons = certBox.querySelector('.cert-actions');
  
  // Hide the buttons temporarily
  buttons.style.display = 'none';

  // Small delay to ensure rendering
  await new Promise(r=>setTimeout(r, 50));

  // Capture
  const canvas = await html2canvas(certBox, { scale: 2 });
  const img = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({ orientation: 'landscape' });
  const pdfWidth = pdf.internal.pageSize.getWidth();
  const pdfHeight = pdf.internal.pageSize.getHeight();
  pdf.addImage(img, 'PNG', 8, 8, pdfWidth - 16, pdfHeight - 16);
  pdf.save(`${(player.name || 'certificate').replace(/\s+/g,'_')}_CivicsSparks_Certificate.pdf`);

  // Restore the buttons
  buttons.style.display = 'flex';
});
const toggleBtn = document.querySelector('.nav-toggle');
const navLinks = document.querySelector('.nav-links');

toggleBtn.addEventListener('click', () => {
  navLinks.classList.toggle('show');
});
fetch('poll.html')
  .then(response => response.text())
  .then(data => {
    document.getElementById('pollContainer').innerHTML= data;
  })
  .catch(err => console.error(err));

   const joinForm = document.getElementById('joinForm');

  joinForm.addEventListener('submit', function(e) {
    // Optional: slight delay to allow email client to open
    setTimeout(() => {
      // Clear input fields
      joinForm.reset();
      // Show popup
      alert("Successfully sent!");
    }, 100);
  });
</script>
  </script>
</body>

</html>



